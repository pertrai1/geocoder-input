{"version":3,"file":"bootstrap-geocoder.js","sources":["../src/GeosearchInput.js"],"sourcesContent":["import { DomUtil, DomEvent, Util, Layer } from \"leaflet\";\nimport { Util as EsriUtil } from \"esri-leaflet\";\nimport { geosearchCore, arcgisOnlineProvider } from \"esri-leaflet-geocoder\";\n\nexport var Search = Layer.extend({\n  options: {\n    allowMultipleResults: true,\n    placeholder: \"Search for places or addresses\",\n    title: \"Location Search\",\n    wrapperStyle: \"usa-card\",\n    suggestionGroupStyle: \"usa-card__body padding-0\",\n    selectedStyle: \"geocoder-control-selected\",\n  },\n\n  initialize: function (options) {\n    // this demo only supports one provider\n    if (!options.providers) {\n      options.providers = [\n        arcgisOnlineProvider({\n          countries: [\"USA\"],\n          maxResults: 10,\n        }),\n      ];\n    }\n\n    Util.setOptions(this, options);\n\n    // instantiate the underlying class and pass along options\n    this._geosearchCore = geosearchCore(this, options);\n    this._geosearchCore.addEventParent(this);\n\n    this._geosearchCore._pendingSuggestions = [];\n\n    // bubble provider events up to the control\n    this._geosearchCore._providers[0].addEventParent(this);\n  },\n\n  _renderSuggestions: function (suggestions) {\n    var nodes = [];\n    var list;\n    var header;\n\n    var currentGroup;\n    this._suggestions.style.display = \"block\";\n\n    for (var i = 0; i < suggestions.length; i++) {\n      var suggestion = suggestions[i];\n\n      if (!list) {\n        list = DomUtil.create(\"ul\", null, suggestion.provider._contentsElement);\n        list.style.display = \"block\";\n      }\n\n      var suggestionItem = DomUtil.create(\n        \"li\",\n        \"geocoder-control-suggestion\",\n        list\n      );\n\n      suggestionItem.innerHTML = suggestion.text;\n      suggestionItem.provider = suggestion.provider;\n      suggestionItem[\"data-magic-key\"] = suggestion.magicKey;\n    }\n\n    nodes.push(list);\n\n    return nodes;\n  },\n\n  clear: function () {\n    this._clearAllSuggestions();\n  },\n\n  _clearAllSuggestions: function () {\n    this._suggestions.style.display = \"none\";\n\n    for (var i = 0; i < this.options.providers.length; i++) {\n      this._clearProviderSuggestions(this.options.providers[i]);\n    }\n  },\n\n  _clearProviderSuggestions: function (provider) {\n    provider._contentsElement.innerHTML = \"\";\n  },\n\n  _finalizeSuggestions: function (activeRequests, suggestionsLength) {\n    // check if all requests are finished to remove the loading indicator\n    if (!activeRequests) {\n      DomUtil.removeClass(this._input, \"geocoder-control-loading\");\n\n      // also check if there were 0 total suggest results to clear the parent suggestions element\n      // otherwise its display value may be \"block\" instead of \"none\"\n      if (!suggestionsLength) {\n        this._clearAllSuggestions();\n      }\n    }\n  },\n\n  onAdd: function (map) {\n    this._map = map;\n    EsriUtil.setEsriAttribution(map);\n\n    this._input = document.getElementById(this.options.inputTag);\n\n    // create a wrapper div around the input\n    this._wrapper = document.createElement(\"div\");\n\n    DomUtil.addClass(this._wrapper, this.options.wrapperStyle);\n\n    this._input.parentNode.insertBefore(this._wrapper, this._input);\n    this._wrapper.appendChild(this._input);\n\n    this._input.title = this.options.title;\n\n    // create dom node for suggestions and place it below the input\n    this._suggestions = document.createElement(\"div\");\n    DomUtil.addClass(this._suggestions, this.options.suggestionGroupStyle);\n\n    // create a child contents container element for each provider inside of this._suggestions\n    // to maintain the configured order of providers for suggested results\n    for (var i = 0; i < this.options.providers.length; i++) {\n      this.options.providers[i]._contentsElement = DomUtil.create(\n        \"div\",\n        null,\n        this._suggestions\n      );\n    }\n\n    this._input.parentNode.insertBefore(this._suggestions, null);\n\n    DomEvent.addListener(\n      this._input,\n      \"focus\",\n      function (e) {\n        this._input.placeholder = this.options.placeholder;\n      },\n      this\n    );\n\n    DomEvent.addListener(\n      this._suggestions,\n      \"mousedown\",\n      function (e) {\n        var suggestionItem = e.target || e.srcElement;\n        this._geosearchCore._geocode(\n          suggestionItem.innerHTML,\n          suggestionItem[\"data-magic-key\"],\n          suggestionItem.provider\n        );\n        this.clear();\n      },\n      this\n    );\n\n    DomEvent.addListener(\n      this._input,\n      \"blur\",\n      function (e) {\n        this._input.placeholder = \"\";\n        this.clear();\n      },\n      this\n    );\n\n    DomEvent.addListener(\n      this._input,\n      \"keydown\",\n      function (e) {\n        var selectedStyle = this.options.selectedStyle;\n\n        var list = this._suggestions.querySelectorAll(\n          \".\" + \"geocoder-control-suggestion\"\n        );\n        var selected = this._suggestions.querySelectorAll(\n          \".\" + selectedStyle\n        )[0];\n        var selectedPosition;\n\n        for (var i = 0; i < list.length; i++) {\n          if (list[i] === selected) {\n            selectedPosition = i;\n            break;\n          }\n        }\n\n        switch (e.keyCode) {\n          case 13: // enter\n            if (selected) {\n              this._geosearchCore._geocode(\n                selected.innerText,\n                selected[\"data-magic-key\"],\n                selected.provider\n              );\n              this.clear();\n            } else if (this.options.allowMultipleResults) {\n              this._geosearchCore._geocode(this._input.value, undefined);\n              this.clear();\n            } else {\n              DomUtil.addClass(list[0], selectedStyle);\n            }\n            DomEvent.preventDefault(e);\n            break;\n          case 38: // up arrow\n            if (selected) {\n              L.DomUtil.removeClass(selected, selectedStyle);\n            }\n\n            var previousItem = list[selectedPosition - 1];\n\n            if (selected && previousItem) {\n              DomUtil.addClass(previousItem, selectedStyle);\n            } else {\n              DomUtil.addClass(list[list.length - 1], selectedStyle);\n            }\n            DomEvent.preventDefault(e);\n            break;\n          case 40: // down arrow\n            if (selected) {\n              DomUtil.removeClass(selected, selectedStyle);\n            }\n\n            var nextItem = list[selectedPosition + 1];\n\n            if (selected && nextItem) {\n              DomUtil.addClass(nextItem, selectedStyle);\n            } else {\n              DomUtil.addClass(list[0], selectedStyle);\n            }\n            DomEvent.preventDefault(e);\n            break;\n          default:\n            // when the input changes we should cancel all pending suggestion requests if possible to avoid result collisions\n            for (\n              var x = 0;\n              x < this._geosearchCore._pendingSuggestions.length;\n              x++\n            ) {\n              var request = this._geosearchCore._pendingSuggestions[x];\n              if (request && request.abort && !request.id) {\n                request.abort();\n              }\n            }\n            break;\n        }\n      },\n      this\n    );\n\n    DomEvent.addListener(\n      this._input,\n      \"keyup\",\n      Util.throttle(\n        function (e) {\n          var key = e.which || e.keyCode;\n          var text = (e.target || e.srcElement).value;\n\n          // require at least 2 characters for suggestions\n          if (text.length < 2) {\n            this._lastValue = this._input.value;\n            this._clearAllSuggestions();\n            return;\n          }\n\n          // if this is the escape key it will clear the input so clear suggestions\n          if (key === 27) {\n            this._clearAllSuggestions();\n            return;\n          }\n\n          // if this is NOT the up/down arrows or enter make a suggestion\n          if (key !== 13 && key !== 38 && key !== 40) {\n            if (this._input.value !== this._lastValue) {\n              this._lastValue = this._input.value;\n              this._geosearchCore._suggest(text);\n            }\n          }\n        },\n        50,\n        this\n      ),\n      this\n    );\n  },\n});\n\nexport function search(options) {\n  return new Search(options);\n}\n"],"names":["Search","Layer","extend","options","allowMultipleResults","placeholder","title","wrapperStyle","suggestionGroupStyle","selectedStyle","initialize","providers","arcgisOnlineProvider","countries","maxResults","Util","setOptions","this","_geosearchCore","geosearchCore","addEventParent","_pendingSuggestions","_providers","_renderSuggestions","suggestions","list","nodes","_suggestions","style","display","i","length","suggestion","DomUtil","create","provider","_contentsElement","suggestionItem","innerHTML","text","magicKey","push","clear","_clearAllSuggestions","_clearProviderSuggestions","_finalizeSuggestions","activeRequests","suggestionsLength","removeClass","_input","onAdd","map","_map","EsriUtil","setEsriAttribution","document","getElementById","inputTag","_wrapper","createElement","addClass","parentNode","insertBefore","appendChild","DomEvent","addListener","e","target","srcElement","_geocode","selectedPosition","querySelectorAll","selected","keyCode","innerText","value","undefined","preventDefault","L","previousItem","nextItem","x","request","abort","id","throttle","key","which","_lastValue","_suggest"],"mappings":"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"}